<img width="2549" height="1326" alt="å±å¹•æˆªå›¾ 2025-07-30 021100" src="https://github.com/user-attachments/assets/08c9cd9f-c54c-4bb3-9eae-d5746b943fc6" />
<img width="2553" height="1324" alt="å±å¹•æˆªå›¾ 2025-07-30 021119" src="https://github.com/user-attachments/assets/ad516248-d605-44c2-a590-fc51b6620a40" />
<img width="2559" height="1319" alt="å±å¹•æˆªå›¾ 2025-07-30 020917" src="https://github.com/user-attachments/assets/db6d91cb-6038-4508-bb9f-3038128d957e" />

#  æµè½¬æ˜Ÿä¸ªäººåšå®¢ - éƒ¨ç½²æŒ‡å—

æ¬¢è¿ä½¿ç”¨æµè½¬æ˜Ÿä¸ªäººåšå®¢ç³»ç»Ÿï¼è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€ç•Œé¢ç‚«é…·çš„å‰åç«¯åˆ†ç¦»ä¸ªäººåšå®¢ã€‚æœ¬æŒ‡å—å°†å¼•å¯¼ä½ å®Œæˆä»é›¶åˆ°ä¸€çš„å®Œæ•´éƒ¨ç½²è¿‡ç¨‹ã€‚

## âœ¨ é¡¹ç›®äº®ç‚¹

- **å…¨åŠŸèƒ½åå°**: æä¾›ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„Webç•Œé¢ï¼Œç”¨äºç®¡ç†æ‰€æœ‰ç½‘ç«™å†…å®¹ï¼ŒåŒ…æ‹¬é¡¹ç›®æ–‡ç« ã€èµ„æºåˆ†äº«ã€æŠ€èƒ½åˆ—è¡¨ã€ä¸ªäººä¿¡æ¯å’ŒèƒŒæ™¯éŸ³ä¹ã€‚
- **é«˜åº¦å¯é…ç½®**: æ— éœ€ä¿®æ”¹ä»£ç ï¼æ‰€æœ‰å…³é”®é…ç½®ï¼ˆå¦‚åŸŸåã€APIå¯†é’¥ã€Nginxè·¯å¾„ï¼‰å‡å¯åœ¨åå°çš„â€œç¯å¢ƒè®¾ç½®â€é¡µé¢ä¸­å®Œæˆã€‚
- **åŠ¨æ€è®¿å®¢é—¨æˆ·**: å‰ç«¯é¡µé¢ (`blogs.html`) åŠ¨æ€ä»åç«¯åŠ è½½æ‰€æœ‰å†…å®¹ï¼Œæ”¯æŒæš—é»‘æ¨¡å¼ã€èƒŒæ™¯éŸ³ä¹æ’­æ”¾ã€æ–‡ç« è¯„è®ºå’ŒAIæ—¥æŠ¥å±•ç¤ºã€‚
- **é›†æˆCloudflare Turnstile**: æ”¯æŒä¸‰ç§å¯é…ç½®çš„å®‰å…¨éªŒè¯æ¨¡å¼ï¼ˆå¼ºéªŒè¯ã€å¼±éªŒè¯ã€å…³é—­ï¼‰ï¼Œæœ‰æ•ˆé˜²æ­¢æœºå™¨äººæ»¥ç”¨ã€‚
- **ä¸»åŠ¨å¼IPå®‰å…¨ç›‘æ§**: ç³»ç»Ÿèƒ½è‡ªåŠ¨ç›‘æ§Nginxæ—¥å¿—ï¼Œå‘ç°å¹¶æ ‡è®°å¯ç–‘è®¿é—®IPï¼Œç®¡ç†å‘˜å¯ä¸€é”®å°ç¦ã€‚
- **è‡ªåŠ¨åŒ–å†…å®¹ç®¡é“**: å†…ç½®ä¸“ç”¨APIï¼Œå¯ä¸n8nç­‰è‡ªåŠ¨åŒ–å·¥å…·æ— ç¼å¯¹æ¥ï¼Œå®ç°å¦‚â€œAIæ—¥æŠ¥â€ç­‰å†…å®¹çš„è‡ªåŠ¨å‘å¸ƒã€‚
- **ç”Ÿäº§çº§Nginxé›†æˆ**: æ·±åº¦é›†æˆNginxï¼Œå®ç°IPé»‘åå•çš„åŠ¨æ€æ›´æ–°ä¸å³æ—¶ç”Ÿæ•ˆã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js, Express.js
- **å‰ç«¯**: åŸç”Ÿ HTML, CSS, JavaScript (æ— æ¡†æ¶)
- **æ•°æ®åº“**: SQLite
- **å¯Œæ–‡æœ¬ç¼–è¾‘å™¨**: TinyMCE
- **æ ¸å¿ƒä¾èµ–**: `cors, bcrypt, jsonwebtoken, multer, chokidar, execa`

## ğŸš€ éƒ¨ç½²æµç¨‹ (Windows ç¯å¢ƒ)
æœ¬æŒ‡å—ä¸»è¦é’ˆå¯¹ Windows 10/11 æˆ– Windows Server ç³»ç»Ÿã€‚

### 1. ç¯å¢ƒå‡†å¤‡
åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»å®‰è£…äº†ä»¥ä¸‹è½¯ä»¶ï¼š

   Node.js

   Nginx

### 2. è·å–ä»£ç ä¸å®‰è£…ä¾èµ–
å°†æœ¬é¡¹ç›®Relaseä¸‹è½½çš„zipæ–‡ä»¶è§£å‹åˆ°ä¸€ä¸ªä½ ç¡®å®šçš„ç›®å½•ã€‚
æ‰“å¼€ å‘½ä»¤æç¤ºç¬¦ (cmd)ï¼Œè¿›å…¥åç«¯ç›®å½•(backend)å¹¶å®‰è£…ä¾èµ–ï¼š
CMD
ä¾‹å¦‚ï¼šcd C:\blog\backend

```bash
npm install
```

å®‰è£…å®Œæˆåï¼Œåœ¨blogç›®å½•ä¸‹æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåä¸º uploads çš„ç©ºæ–‡ä»¶å¤¹ï¼ï¼ï¼

### 3. è·å–å®‰å…¨å¯†é’¥ (Cloudflare)

   æœ¬åšå®¢ä½¿ç”¨ Cloudflare Turnstile è¿›è¡ŒäººæœºéªŒè¯ï¼Œä½ éœ€è¦å…è´¹æ³¨å†Œä¸€ä¸ª Cloudflare è´¦å·å¹¶è·å–å¯†é’¥ã€‚

   ç™»å½• Cloudflare è´¦å·ï¼Œåœ¨å·¦ä¾§èœå•è¿›å…¥ Turnstileã€‚
   
   ç‚¹å‡» Add siteï¼Œå¡«å†™ä½ çš„ç½‘ç«™åç§°ï¼Œé€‰æ‹©ä½ çš„åŸŸåï¼Œç„¶åç‚¹å‡» Createã€‚

   åœ¨ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œä½ ä¼šçœ‹åˆ° Site Key (ç«™ç‚¹å¯†é’¥) å’Œ Secret Key (ç§é’¥)ã€‚è¯·å°†è¿™ä¸¤ä¸ªå€¼å¤åˆ¶ä¸‹æ¥ï¼Œç¨åä¼šç”¨åˆ°ã€‚

### 4. ç³»ç»Ÿåˆå§‹åŒ–é…ç½®

1.  **ä¿®æ”¹å‰ç«¯APIåœ°å€**:
    *   æ‰“å¼€blogs.htmlæ–‡ä»¶ã€‚
    *   æ‰¾åˆ°æ–‡ä»¶é¡¶éƒ¨çš„ `<script>` å—ï¼Œä¿®æ”¹ `API_BASE_URL` å¸¸é‡ä¸ºæ‚¨åç«¯APIçš„å®Œæ•´åœ°å€ã€‚
        ```javascript
        // è¿™æ˜¯ç”¨æˆ·éƒ¨ç½²æ—¶å”¯ä¸€éœ€è¦ä¿®æ”¹çš„åœ°æ–¹
        const API_BASE_URL = 'https://api.example.com/api'; 
        ```
    
2.  **ç™»å½•åå°å¹¶å®Œæˆé…ç½®**:
    *   é€šè¿‡æ‚¨çš„åç«¯åŸŸåè®¿é—®åå°ï¼Œä¾‹å¦‚ `https://api.example.com/admin`ã€‚
    *   ä½¿ç”¨é»˜è®¤å‡­è¯ç™»å½•ï¼š
        -   **ç”¨æˆ·å**: `admin`
        -   **å¯†ç **: `admin123`
    *   è¿›å…¥ **â€œç¯å¢ƒè®¾ç½®â€** Tabã€‚
    *   **ä»”ç»†å¡«å†™æ‰€æœ‰å­—æ®µ**ï¼Œç‰¹åˆ«æ˜¯ï¼š
        -   `åç«¯URL`: `https://api.example.com`
        -   `JWTå¯†é’¥`: **å¼ºçƒˆå»ºè®®**ä¿®æ”¹ä¸ºä¸€ä¸ªå¤æ‚çš„éšæœºå­—ç¬¦ä¸²ã€‚
        -   `Cloudflare Turnstile` çš„ `Site Key` å’Œ `Secret Key`ã€‚
        -   æ‰€æœ‰ `Nginx è·¯å¾„`ï¼Œç¡®ä¿ä¸æ‚¨æœåŠ¡å™¨ä¸Šçš„å®é™…è·¯å¾„å®Œå…¨ä¸€è‡´ã€‚
    *   ç‚¹å‡» **â€œä¿å­˜æ‰€æœ‰è®¾ç½®â€**ã€‚

3.  **ä¿®æ”¹ç®¡ç†å‘˜å¯†ç **:
    *   è¿›å…¥ **â€œåŠŸèƒ½è®¾ç½®â€** Tabï¼Œä¿®æ”¹é»˜è®¤çš„ç®¡ç†å‘˜å¯†ç ã€‚
### 5. é…ç½®å¹¶å¯åŠ¨ Nginx
åœ¨ä¾‹å¦‚C:\nginx\conf ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º blockips.conf çš„ç©ºæ–‡ä»¶ã€‚è¿™æ˜¯ç»™åç«¯ç¨‹åºå†™å…¥é»‘åå•ç”¨çš„ã€‚

   ç”¨ç¼–è¾‘å™¨æ‰“å¼€ C:\nginx\conf\nginx.conf æ–‡ä»¶ï¼Œå‚è€ƒç¤ºä¾‹ä»£ç è¿›è¡Œä¿®æ”¹ï¼š
   
```nginx
worker_processes  1;

# Nginx é”™è¯¯æ—¥å¿—è·¯å¾„ï¼Œå¿…é¡»ä¸åç«¯ä¸­çš„Nginxé”™è¯¯è·¯å¾„ä¸€è‡´
error_log  logs/error.log warn; 

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    charset       utf-8;

    # --- IP é»‘åå•é…ç½® ---
    geo $remote_addr $blocked_ip {
        default 0; 
        # å¼•å…¥é»‘åå•æ–‡ä»¶ï¼Œè·¯å¾„å¿…é¡»ä¸åç«¯ä¸­çš„Nginxé»‘åå•è·¯å¾„ä¸€è‡´
        include C:/nginx/conf/blockips.conf;
    }
    
    # --- é€Ÿç‡é™åˆ¶ ---
    limit_req_zone $binary_remote_addr zone=loginlimit:10m rate=10r/m;
    limit_req_zone $binary_remote_addr zone=bloglimit:10m rate=20r/m;

    # --- åšå®¢å‰ç«¯ (å…¬å¼€è®¿é—®) ---
    server {
        listen 80;
        # ã€æ›¿æ¢ã€‘æ¢æˆä½ çš„åšå®¢å‰ç«¯åŸŸå
        server_name blog.yourdomain.com; 

        # å¦‚æœIPåœ¨é»‘åå•ä¸­ï¼Œåˆ™æ‹’ç»è®¿é—®
        if ($blocked_ip) {
            return 403;
        }
        
        # åº”ç”¨é€Ÿç‡é™åˆ¶
        limit_req zone=bloglimit burst=15 nodelay;

        # ã€æ³¨æ„ã€‘é¡¹ç›®æ ¹ç›®å½•è·¯å¾„ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¸åœ¨ C:/blogï¼Œè¯·ä¿®æ”¹è¿™é‡Œ
        root   C:/blog;
        index  blogs.html;

        # ä»£ç†ä¸Šä¼ æ–‡ä»¶çš„è®¿é—®è·¯å¾„
        location /uploads {
            # ã€æ³¨æ„ã€‘æŒ‡å‘åç«¯ uploads ç›®å½•çš„ç»å¯¹è·¯å¾„
            alias C:/blog/backend/uploads; 
            expires 7d;
            add_header Cache-Control "public";
        }

        # å¤„ç†å‰ç«¯è·¯ç”±
        location / {
            try_files $uri $uri/ /blogs.html;
        }
        location ~* \.(jpg|jpeg|png|gif|ico|css|js|ttf|woff|woff2)$ {
            expires 7d;
            add_header Cache-Control "public, immutable";
            add_header Vary "Accept-Encoding";
        }

        # --- éŸ³é¢‘æ–‡ä»¶ä¸“ç”¨é…ç½® ---
        location ~* \.(mp3|flac|ogg|wav|m4a)$ {
            expires 30d;
            add_header Cache-Control "public, immutable";
            add_header Accept-Ranges bytes; # æ”¯æŒæ–­ç‚¹ç»­ä¼ 
        }

        # --- HTMLæ–‡ä»¶é…ç½®ï¼ˆåŒ…æ‹¬AIæ—¥æŠ¥é¡µé¢ï¼‰ ---
        location ~* \.html$ {
            expires 1h;
            add_header Cache-Control "public, must-revalidate";
            try_files $uri $uri/ /blogs.html;
        }
    }

    # --- åšå®¢åç«¯ (ç®¡ç†åå°) ---
    server {
        listen 80;
        # ã€æ›¿æ¢ã€‘æ¢æˆä½ çš„åšå®¢åç«¯åŸŸå
        server_name blog-admin.yourdomain.com;
        client_max_body_size 200M;

        # å¦‚æœIPåœ¨é»‘åå•ä¸­ï¼Œåˆ™æ‹’ç»è®¿é—®
        if ($blocked_ip) {
            return 403;
        }

        # é‡å®šå‘æ ¹è·¯å¾„åˆ° /admin
        location = / {
               return 301 /admin;
        }
        
        # å¯¹ç™»å½•æ¥å£åº”ç”¨é€Ÿç‡é™åˆ¶
        location = /api/auth/login {
            limit_req zone=loginlimit burst=5 nodelay;
            proxy_pass http://127.0.0.1:3001;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # åå‘ä»£ç†åˆ° Node.js æœåŠ¡
        location / {
            proxy_pass http://127.0.0.1:3001; 
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
    # ---å¦‚æœå¯ç”¨n8nå·¥ä½œæµåˆ™æ·»åŠ  n8n ---
    server {
        listen 80;
        # ã€æ›¿æ¢ã€‘æ¢æˆä½ çš„n8nå®ä¾‹åŸŸå
        server_name yourdomain.com;
        client_max_body_size 100M; # æ ¹æ®éœ€è¦è°ƒæ•´ï¼Œn8nå·¥ä½œæµå¯èƒ½å¤„ç†å¤§æ–‡ä»¶

        # æ²¿ç”¨IPé»‘åå•æœºåˆ¶
        if ($blocked_ip) {
              return 403;
        }

        location / {
            # ä»£ç†åˆ°æœ¬åœ°çš„ n8n å®ä¾‹
            proxy_pass http://127.0.0.1:5678;

            # --- ä»¥ä¸‹æ˜¯ä»£ç† WebSocket å’Œé•¿è¿æ¥çš„å…³é”®é…ç½® ---
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "Upgrade";

            # --- ä¼ é€’å¿…è¦çš„å¤´éƒ¨ä¿¡æ¯ ---
            proxy_set_header Host $host;
            # ä¼ é€’çœŸå®å®¢æˆ·ç«¯IP
            proxy_set_header X-Real-IP $http_x_forwarded_for;
            proxy_set_header X-Forwarded-For $http_x_forwarded_for;
            # å‘ŠçŸ¥åç«¯åº”ç”¨åŸå§‹åè®®æ˜¯HTTPSï¼ˆå¦‚æœå‰ç«¯æœ‰SSLï¼‰
            proxy_set_header X-Forwarded-Proto https;

            # --- é’ˆå¯¹n8nçš„ä¼˜åŒ– ---
            # ç¦ç”¨ä»£ç†ç¼“å†²ï¼Œå¯¹äºäº‹ä»¶æµå’Œé•¿è½®è¯¢å¾ˆé‡è¦
            proxy_buffering off;
            # å»¶é•¿è¶…æ—¶æ—¶é—´ï¼Œä»¥é˜²å·¥ä½œæµæ‰§è¡Œæ—¶é—´è¿‡é•¿
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
        }
    }
}
```

ã€æ›¿æ¢ã€‘ å°†ä¸Šé¢é…ç½®ä¸­çš„ blog.yourdomain.com å’Œ blog-admin.yourdomain.com ä»¥åŠæ¢æˆä½ è‡ªå·±çš„åŸŸåã€‚

é»˜è®¤å¯ç”¨é€Ÿç‡é™åˆ¶ï¼Œä½ ä¹Ÿå¯ä»¥åˆ é™¤ä¸ä»–æœ‰å…³çš„æ¨¡å—ï¼Œå¼ƒç”¨é€Ÿç‡é™åˆ¶ã€‚

# é™„æ³¨ï¼šå…³äº Nginx é…ç½®ä¸­çš„ä»£ç†å¤´éƒ¨ (Proxy Headers)

ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ Nginx é…ç½®çš„ location / å—ä¸­ï¼Œæœ‰å‡ è¡Œ proxy_set_header çš„é…ç½®ã€‚è¿™äº›é…ç½®éå¸¸é‡è¦ï¼Œè¯·ä¿æŒåŸæ ·ã€‚

å®ƒä»¬çš„ä½œç”¨æ˜¯å°†çœŸå®çš„è®¿å®¢ä¿¡æ¯ä¼ é€’ç»™åç«¯ Node.js æœåŠ¡ã€‚

ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ

å› ä¸º Nginx æ˜¯ä¸€ä¸ªåå‘ä»£ç†ï¼ˆä¸­é—´äººï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›è®¾ç½®ï¼Œä½ çš„åç«¯åº”ç”¨ä¼šè®¤ä¸ºæ‰€æœ‰è¯·æ±‚éƒ½æ¥è‡ªæœåŠ¡å™¨è‡ªå·± (127.0.0.1)ã€‚è¿™å°†å¯¼è‡´ IP é»‘åå•ã€è®¿é—®æ—¥å¿—ç­‰åŠŸèƒ½å®Œå…¨å¤±æ•ˆã€‚

å®ƒä»¬åšäº†ä»€ä¹ˆï¼Ÿ

X-Real-IP å’Œ X-Forwarded-Forï¼šå°†çœŸå®çš„è®¿å®¢ IP åœ°å€å‘Šè¯‰åç«¯ã€‚

X-Forwarded-Protoï¼šå°†è®¿å®¢ä½¿ç”¨çš„åè®®ï¼ˆhttp æˆ– httpsï¼‰å‘Šè¯‰åç«¯ï¼Œè¿™å¯¹äºæ­£ç¡®ç”Ÿæˆé“¾æ¥è‡³å…³é‡è¦ã€‚

ç»“è®ºï¼šä½ éœ€è¦è‡ªå®šä¹‰é…ç½®ä½ åŸŸåçš„ï¼ˆè‡ªå®šä¹‰å¤´éƒ¨æºå¸¦å®¢æˆ·ç«¯ IP ä¿¡æ¯å›æºç«™ï¼‰ï¼Œä¾‹å¦‚æˆ‘ä½¿ç”¨çš„EdgeOneâ€œå®¢æˆ·ç«¯IPå¤´éƒ¨â€ï¼Œå°†åç§°è®¾ç½®ä¸ºâ€œX-Forwarded-Forâ€

ä½ ä¸éœ€è¦ä¿®æ”¹è¿™äº›è¡Œã€‚æˆ‘ä»¬æä¾›çš„ Nginx é…ç½®å·²ç»ä¸ºä½ æ­£ç¡®è®¾ç½®å¥½äº†ï¼Œä»¥ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚

æ‰“å¼€å‘½ä»¤æç¤ºç¬¦(cmd)ï¼Œå¯åŠ¨ Nginxï¼š

CMD
cd C:\nginx
nginx -t      # æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œå¿…é¡»æ˜¾ç¤ºokä»¥åŠsuccessful
start nginx   # å¯åŠ¨ Nginx æœåŠ¡

### 6. å¯åŠ¨åç«¯æœåŠ¡
å›åˆ° C:\blog\backend ç›®å½•çš„å‘½ä»¤æç¤ºç¬¦çª—å£ã€‚
å¯åŠ¨åç«¯æœåŠ¡ï¼š
CMD
node server.js
çœ‹åˆ° æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3001 ç­‰æç¤ºå³è¡¨ç¤ºæˆåŠŸã€‚æ­¤çª—å£éœ€è¦ä¿æŒæ‰“å¼€ã€‚ï¼ˆå»ºè®®ä»¥ç®¡ç†å‘˜è¿è¡Œï¼Œæˆ–è€…ç»™è¿›ç¨‹ç»™äºˆä¿®æ”¹nginxé»‘åå•æ–‡ä»¶çš„æƒé™ç­‰ï¼‰

### 7. ğŸš¨ å®Œæˆä¸å®‰å…¨è®¾ç½®
é˜²ç«å¢™è®¾ç½®:

æ‰“å¼€ Windows Defender é˜²ç«å¢™ -> é«˜çº§è®¾ç½® -> å…¥ç«™è§„åˆ™ -> æ–°å»ºè§„åˆ™ã€‚

é€‰æ‹© "ç«¯å£"ï¼Œåè®® "TCP"ï¼Œç‰¹å®šæœ¬åœ°ç«¯å£ "80"ï¼Œå…è®¸è¿æ¥ã€‚

å‘½åä¸º "Nginx HTTP" å¹¶ä¿å­˜ã€‚

è®¿é—®ç½‘ç«™:

å‰ç«¯åšå®¢: http://blog.yourdomain.com

åå°ç®¡ç†: http://blog-admin.yourdomain.com/admin

é¦–æ¬¡ç™»å½•ä¸ä¿®æ”¹å¯†ç :

é»˜è®¤ç”¨æˆ·å: admin

é»˜è®¤å¯†ç : admin123

## åœ¨è¯„è®ºåŒºå¯ç”¨åšä¸»ç‰¹æ®Šè¯„è®ºï¼Œåœ¨é‚®ç®±è¾“å…¥ä½ çš„åå°ç®¡ç†å¯†ç å³å¯

### 8.å¦‚æœå¯ç”¨AIæ—©æŠ¥(é…åˆn8n)
è¯·å‚ç…§æˆ‘ä»¬çš„å¤„ç†æ ¼å¼
<img width="1423" height="559" alt="å±å¹•æˆªå›¾ 2025-07-30 030051" src="https://github.com/user-attachments/assets/a58124e1-7ba7-46e5-a3a9-984715c93b43" />
<img width="2527" height="1255" alt="å±å¹•æˆªå›¾ 2025-07-30 025759" src="https://github.com/user-attachments/assets/89f09a26-4ccc-45de-b189-f70cff6410c6" />
```javascript
// ä»ä¸Šä¸€èŠ‚ç‚¹è·å–AIç”Ÿæˆçš„å†…å®¹
const aiContent = $input.first().json.output;

// æ™ºèƒ½æå–æ‘˜è¦å‡½æ•°
function extractSummary(content) {
  // å»é™¤HTMLæ ‡ç­¾
  let cleanText = content.replace(/<[^>]*>/g, '').trim();
  
  // å»é™¤å¤šä½™çš„æ¢è¡Œå’Œç©ºæ ¼
  cleanText = cleanText.replace(/\s+/g, ' ');
  
  // æŒ‰å¥å·åˆ†å‰²å¥å­
  const sentences = cleanText.split(/[ã€‚ï¼ï¼Ÿ.!?]/);
  
  // å–å‰1-2ä¸ªå¥å­ä½œä¸ºæ‘˜è¦
  let summary = sentences[0];
  if (summary.length < 50 && sentences[1]) {
    summary += 'ã€‚' + sentences[1];
  }
  
  // ç¡®ä¿æ‘˜è¦é•¿åº¦ä¸è¶…è¿‡150å­—ç¬¦
  if (summary.length > 150) {
    summary = summary.substring(0, 147) + '...';
  }
  
  // å¦‚æœæ‘˜è¦å¤ªçŸ­ï¼Œä½¿ç”¨é»˜è®¤æ‘˜è¦
  if (summary.length < 20) {
    summary = 'ä»Šæ—¥AIè¡Œä¸šé‡è¦åŠ¨æ€æ±‡æ€»ï¼ŒåŒ…å«æœ€æ–°æŠ€æœ¯è¿›å±•å’Œäº§å“å‘å¸ƒä¿¡æ¯';
  }
  
  return summary;
}

// è®¡ç®—äº®ç‚¹æ•°é‡å‡½æ•°
function countHighlights(content) {
  // ç»Ÿè®¡ç‰¹æ®Šæ ‡è®°emojiçš„æ•°é‡
  const emojiMarkers = content.match(/ğŸŒŸ|ğŸ“Š|ğŸ”¬|ğŸ’¡|ğŸš€|â­|ğŸ”¥|ğŸ“ˆ|âš¡|ğŸ¯/g) || [];
  
  // ç»Ÿè®¡h3æ ‡é¢˜æ•°é‡ï¼ˆé€šå¸¸ä»£è¡¨ä¸åŒç±»åˆ«ï¼‰
  const h3Tags = content.match(/<h3[^>]*>/g) || [];
  
  // ç»Ÿè®¡news-itemæ•°é‡
  const newsItems = content.match(/news-item/g) || [];
  
  // å–æœ€å¤§å€¼ï¼Œä½†è‡³å°‘ä¸º1ï¼Œæœ€å¤šä¸º10
  const maxCount = Math.max(
    emojiMarkers.length,
    h3Tags.length,
    Math.floor(newsItems.length / 2)
  );
  
  return Math.min(Math.max(1, maxCount), 10);
}

// ç”Ÿæˆæ ¼å¼åŒ–çš„æ—¥æœŸå’Œæ ‡é¢˜
function generateDateAndTitle() {
  const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0');
  const day = String(today.getDate()).padStart(2, '0');
  
  const reportDate = `${year}-${month}-${day}`;
  const title = `${year}å¹´${month}æœˆ${day}æ—¥ AIæ—¥æŠ¥`;
  
  return { reportDate, title };
}

// éªŒè¯å’Œæ¸…ç†å†…å®¹
function validateContent(content) {
  if (!content || content.trim().length < 50) {
    throw new Error('AIç”Ÿæˆçš„å†…å®¹å¤ªçŸ­ï¼Œæ— æ³•åˆ›å»ºæ—¥æŠ¥');
  }
  
  // ç¡®ä¿å†…å®¹åŒ…å«åŸºæœ¬çš„HTMLç»“æ„
  if (!content.includes('<div') && !content.includes('<h3')) {
    // å¦‚æœæ²¡æœ‰HTMLç»“æ„ï¼Œæ·»åŠ åŸºæœ¬åŒ…è£…
    return `<div class="ai-report-content">
      <h3>ğŸŒŸ ä»Šæ—¥AIäº®ç‚¹</h3>
      <div class="news-item">
        <p>${content}</p>
      </div>
    </div>`;
  }
  
  return content;
}

try {
  // éªŒè¯è¾“å…¥æ•°æ®
  if (!aiContent) {
    throw new Error('æœªæ‰¾åˆ°AIç”Ÿæˆçš„å†…å®¹');
  }
  
  // æ¸…ç†å’ŒéªŒè¯å†…å®¹
  const cleanedContent = validateContent(aiContent);
  
  // ç”Ÿæˆæ—¥æœŸå’Œæ ‡é¢˜
  const { reportDate, title } = generateDateAndTitle();
  
  // æå–æ‘˜è¦
  const summary = extractSummary(cleanedContent);
  
  // è®¡ç®—äº®ç‚¹æ•°é‡
  const highlightsCount = countHighlights(cleanedContent);
  
  // è¿”å›æ ¼å¼åŒ–çš„è¯·æ±‚ä½“æ•°æ®
  return [{
    json: {
      requestBody: {
        title: title,
        content: cleanedContent,
        summary: summary,
        report_date: reportDate,
        highlights_count: highlightsCount
      },
      // æ·»åŠ è°ƒè¯•ä¿¡æ¯
      debug: {
        originalContentLength: aiContent.length,
        summaryLength: summary.length,
        highlightsCount: highlightsCount,
        reportDate: reportDate
      }
    }
  }];
  
} catch (error) {
  // é”™è¯¯å¤„ç†
  console.error('å¤„ç†AIæ—¥æŠ¥æ•°æ®æ—¶å‡ºé”™:', error.message);
  
  return [{
    json: {
      error: true,
      message: error.message,
      // æä¾›å¤‡ç”¨æ•°æ®
      requestBody: {
        title: new Date().toISOString().split('T')[0] + ' AIæ—¥æŠ¥ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰',
        content: aiContent || '<div class="ai-report-content"><p>å†…å®¹ç”Ÿæˆå¤±è´¥</p></div>',
        summary: 'ä»Šæ—¥AIè¡Œä¸šåŠ¨æ€æ±‡æ€»',
        report_date: new Date().toISOString().split('T')[0],
        highlights_count: 1
      }
    }
  }];
}
```
<img width="961" height="1210" alt="å±å¹•æˆªå›¾ 2025-07-30 030202" src="https://github.com/user-attachments/assets/c7c7b596-72b2-40ef-b5b1-4189b9eaba18" />
<img width="932" height="1099" alt="å±å¹•æˆªå›¾ 2025-07-30 030211" src="https://github.com/user-attachments/assets/d72a9432-7f69-4123-94ca-e7cd8cc66bf7" />

```json
{
  "Content-Type": "application/json; charset=utf-8",
  "User-Agent": "n8n-ai-report-bot/1.0"
}
```

## ğŸ“ æ³¨æ„äº‹é¡¹

- **å®‰å…¨**: é¦–æ¬¡éƒ¨ç½²åï¼Œè¯·åŠ¡å¿…ä¿®æ”¹é»˜è®¤çš„ç®¡ç†å‘˜å¯†ç å’ŒJWTå¯†é’¥ã€‚
- **å¤‡ä»½**: å®šæœŸå¤‡ä»½ `backend/database.db` æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†æ‚¨æ‰€æœ‰çš„æ•°æ®ã€‚
- **Nginxè·¯å¾„**: å¦‚æœæ‚¨åœ¨Windowsä¸Šéƒ¨ç½²ï¼Œè¯·ç¡®ä¿è·¯å¾„æ ¼å¼æ­£ç¡®ï¼Œä¾‹å¦‚ `C:/nginx/conf/blockips.conf`ã€‚
- **CORS**: å¦‚æœæ‚¨å†³å®šå°†å‰ç«¯å’Œåç«¯éƒ¨ç½²åœ¨ä¸åŒçš„ä¸»åŸŸåä¸‹ï¼ˆéå­åŸŸåï¼‰ï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨ `server.js` ä¸­è°ƒæ•´CORSé…ç½®ã€‚

(å¯é€‰) ä½¿ç”¨ PM2 å®ç°æœåŠ¡æŒä¹…åŒ–ï¼ˆä½†æˆ‘æ²¡è¯•è¿‡ï¼‰
